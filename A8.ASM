TITLE A8:ASSIGNMENT_8
.MODEL SMALL
.8087


DISPLAY MACRO X
	MOV DL,X
	MOV AH,2
	INT 21H
ENDM

.STACK 100H
.DATA
	NUM1 DT 0
	NUM2 DT 0
.CODE

MAIN PROC
	MOV AX,@DATA
	MOV DS,AX
	MOV ES,AX
	DISPLAY '?'
	LEA BX,NUM1
	CALL READ_FLOAT
	FLD NUM1
	FWAIT
	LEA BX,NUM1
	CALL PRINT_FLOAT
	MOV AH,76
	INT 21H
MAIN ENDP

READ_FLOAT PROC

	XOR DX,DX
	XOR BP,BP
	MOV SI,BX

RF_LOOP1:
	MOV AH,01
	INT 21H
	CMP AL,'-'
	JNE RF_1
	MOV BYTE PTR [BX+9],80H
	JMP RF_LOOP1

RF_1:
	CMP AL,'.'
	JNE RF_2
	INC DH
	JMP RF_LOOP1
	
RF_2:
	CMP AL,0DH
	JE RF_3
	AND AL,0FH
	INC BP
	PUSH AX
	CMP DH,0
	JE RF_LOOP1
	INC DL
	JMP RF_LOOP1
	
RF_3:
	MOV CL,4

RF_LOOP2:
	POP AX
	MOV [BX],AL
	DEC BP
	JE RF_4
	POP AX
	SHL AL,CL
	OR [BX],AL
	INC BX
	DEC BP
	JG RF_LOOP2

RF_4:
	FBLD TBYTE PTR [SI]
	FWAIT
	CMP DL,0
	JE RF_5
	XOR CX,CX
	MOV CL,DL
	MOV AX,1
	MOV BX,10

RF_LOOP3:
	IMUL BX
	LOOP RF_LOOP3
	MOV [SI],AX
	FIDIV WORD PTR [SI]

RF_5: 
	FSTP TBYTE PTR [SI]
	FWAIT
	RET 
	
READ_FLOAT ENDP

PRINT_FLOAT PROC
	MOV AH,2
	MOV WORD PTR [BX],10000
	FIMUL WORD PTR [BX]
	FBSTP TBYTE PTR [BX]
	FWAIT
	TEST BYTE PTR[BX+9],80H
	JE PF_1
	MOV DL,'-'
	;MOV AH,2
	INT 21H
	
PF_1:
	ADD BX,8
	MOV CH,7
	MOV CL,4
	MOV DH,2

PF_LOOP:
	MOV DL,[BX]
	SHR DL,CL
	OR DL,30H
	INT 21H
	MOV DL,[BX]
	AND DL,0FH
	OR DL,30H
	INT 21H
	DEC BX
	DEC CH
	JG PF_LOOP
	DEC DH
	JE PF_DONE
	DISPLAY '.'
	MOV CH,2
	JMP PF_LOOP
	
PF_DONE:
	RET

PRINT_FLOAT ENDP

END MAIN